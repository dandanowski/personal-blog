{% assign related_posts = "" | split: "" %}
{% for page_tag in page.tags %}
    {% assign tag_found = site.posts | where: "tags", page_tag %}
    {% assign related_posts = related_posts | concat: tag_found %}
{% endfor %}
{% assign related_posts = related_posts | uniq %}

{% if related_posts %}
<div class="related-posts">
    <h2>Related</h2>
    <ul>
        {% for post in related_posts %}
            {% if post.id != page.id %}
            <li>
                <h4><a href="{{ post.url }}">{{post.title}}</a></h4>
                {{post.excerpt}}
            </li>
            {% endif %}
        {% endfor %}
    </ul>
</div>
{% endif %}